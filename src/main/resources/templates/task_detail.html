<!-- layout.html 템플릿 상속 -->
<html layout:decorate="~{layout}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" lang="ko">
<!-- 부모 템플릿 th:block 엘리먼트 내용을 자식 템플릿의 div 엘리먼트 내용으로 교체 -->
<div layout:fragment="content" class="rootContainer">
    <div class="mainContainer">
        <!-- 상단바: 뒤로가기 버튼, Task 제목, Task 제목 수정하기 버튼 -->
        <header>
            <button onclick="history.back()" >뒤로</button>
            <span th:text="${task.subject}"></span>
            <!-- GET 방식으로 제목을 불러오고, POST 방식으로 제목을 수정 -->
            <a th:href="@{|/task/modify/${task.id}|}" th:text="'수정'"></a>
        </header>

        <!-- 통계 영역: 그래프 -->
        <div>
            <canvas id="myChart"></canvas>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>

        <script th:inline="javascript">
            let estimatedTimeList = [[${estimatedTimeList}]];
            let totalTimeList = [[${totalTimeList}]];
            let completeTimeList = [[${completeTimeList}]];

            const ctx = document.getElementById('myChart');

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: completeTimeList,
                    datasets: [
                        {
                        label: '예상 처리 시간',
                        data: estimatedTimeList,
                        borderWidth: 1,
                        },
                        {
                        label: '실제 처리 시간',
                        data: totalTimeList,
                        borderWidth: 1,
                        }
                    ],
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        </script>

        <!-- 태스크 이력: taskMeasures 목록 -->
        <table>
            <thead>
                <tr>
                    <th>시작 시각</th>
                    <th>총 소요 시간</th>
                    <th>예상 처리 시간</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="taskMeasure: ${taskMeasureList}">
                    <td>
                        <a th:href="@{|/task/measures/modify/${taskMeasure.id}|}" th:text="${taskMeasure.startTime}"></a>
                    </td>
                    <td th:text="${taskMeasure.totalElapsedTime}"></td>
                    <td th:text="${taskMeasure.estimatedAt}"></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
</html>
